<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reclamos Pendientes - Dashboard T√©cnicos</title>
    <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#0f172a;color:#e2e8f0;padding:20px;min-height:100vh}.container{max-width:1400px;margin:0 auto}.header{background:#1e293b;padding:30px;border-radius:12px;margin-bottom:30px;border:1px solid #334155}.header h1{color:#f1f5f9;font-size:32px;margin-bottom:10px;font-weight:700}.header-content{display:flex;justify-content:space-between;align-items:center;margin-top:20px;padding-top:20px;border-top:1px solid #334155;flex-direction:row-reverse}.update-info{color:#94a3b8;font-size:14px}.contador-pendientes{text-align:center;background:linear-gradient(135deg,#6366f1 0%,#8b5cf6 100%);padding:20px 40px;border-radius:12px;box-shadow:0 0 30px rgba(99,102,241,0.3)}.contador-numero{font-size:56px;font-weight:800;color:white;line-height:1}.contador-label{color:rgba(255,255,255,0.9);font-size:14px;text-transform:uppercase;font-weight:600;margin-top:8px;letter-spacing:1px}.reclamo{background:#1e293b;margin-bottom:15px;border-radius:12px;border:1px solid #334155;overflow:hidden;transition:all 0.3s ease;cursor:pointer}.reclamo:hover{border-left-color:#6366f1;box-shadow:0 0 30px rgba(99,102,241,0.2)}.reclamo.expandido{cursor:default}.reclamo-compacto{padding:18px 20px;display:flex;justify-content:space-between;align-items:center;gap:15px}.reclamo-compacto-info{flex:1;display:flex;gap:20px;align-items:center}.orden-compacto{font-size:16px;font-weight:700;color:#6366f1;min-width:120px}.cliente-compacto{font-size:16px;font-weight:600;color:#f1f5f9;flex:1}.problema-compacto{font-size:16px;color:#cbd5e1;flex:1.2;font-weight:600}.icono-expandir{color:#6366f1;font-size:20px;transition:transform 0.3s ease}.reclamo.expandido .icono-expandir{transform:rotate(180deg)}.reclamo-detalle{max-height:0;overflow:hidden;transition:max-height 0.4s ease}.reclamo.expandido .reclamo-detalle{max-height:2000px}.reclamo-top{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);padding:20px;border-bottom:1px solid #334155;border-top:1px solid #334155;display:flex;justify-content:space-between;align-items:center}.orden-numero{font-size:24px;font-weight:700;color:#6366f1}.fecha-info{color:#94a3b8;font-size:14px}.reclamo-content{padding:25px}.cliente-section{display:flex;gap:30px;margin-bottom:25px;padding-bottom:20px;border-bottom:1px solid #334155}.cliente-info{flex:1}.cliente-nombre{font-size:20px;font-weight:600;color:#f1f5f9;margin-bottom:10px}.contacto{display:flex;gap:20px;color:#94a3b8;font-size:14px}.contacto span{display:flex;align-items:center;gap:8px}.problema-section{background:rgba(239,68,68,0.1);border-left:3px solid #ef4444;padding:15px;border-radius:8px;margin:20px 0}.problema-title{color:#fca5a5;font-weight:600;margin-bottom:8px}.problema-detalle{color:#e2e8f0;line-height:1.6}.tecnico-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;background:rgba(99,102,241,0.05);padding:20px;border-radius:8px;border:1px solid rgba(99,102,241,0.2)}.tecnico-label{color:#6366f1;font-size:12px;font-weight:600;text-transform:uppercase}.tecnico-value{color:#cbd5e1;font-size:14px}.btn{margin-top:20px;padding:14px 28px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:15px;background:linear-gradient(135deg,#6366f1 0%,#8b5cf6 100%);color:white;transition:all 0.3s ease}.btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(99,102,241,0.3)}.estado-badge{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase}.badge-pendiente{background:rgba(251,191,36,0.2);color:#fbbf24;border:1px solid #fbbf24}.badge-completado{background:rgba(34,197,94,0.2);color:#22c55e;border:1px solid #22c55e}.form-trabajo{margin-top:15px;padding:15px;background:rgba(15,23,42,0.5);border-radius:8px;border:1px solid #334155;display:none}.form-trabajo.visible{display:block}.form-trabajo input,.form-trabajo textarea{width:100%;padding:10px;margin:8px 0;background:#1e293b;border:1px solid #334155;border-radius:6px;color:#e2e8f0;font-size:14px}.form-trabajo input:focus,.form-trabajo textarea:focus{outline:none;border-color:#6366f1}.form-trabajo button{margin-top:10px;margin-right:10px}.trabajo-realizado{background:rgba(34,197,94,0.1);border-left:3px solid #22c55e;padding:15px;border-radius:8px;margin-top:15px}.trabajo-realizado strong{color:#22c55e}@media (max-width:768px){.header-content{flex-direction:column;gap:20px;text-align:center}.contador-pendientes{width:100%}.reclamo-compacto-info{flex-direction:column;align-items:flex-start;gap:8px}}</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ†Ô∏è Dashboard T√©cnico - Nodosoft</h1>
            <div class="header-content">
                <div class="update-info">√öltima actualizaci√≥n: 25/10/2025 12:11:32</div>
                <div class="contador-pendientes">
                    <div class="contador-numero" id="totalPendientes">0</div>
                    <div class="contador-label">Reclamos Pendientes</div>
                </div>
            </div>
        </div>

    <script>
        const _tk = ['Z2hwX3BRTmw=','TXJRbzNldWc=','RjNUQ1JPdmE=','ZDVpT2tlM2U=','b2gwakdwWmQ='];
        const REPO_OWNER = 'marianogemelli1999';
        const REPO_NAME = 'marianogemelli1999.github-io';
        const FILE_PATH = 'trabajos.json';
        
        function _dt() {
            return _tk.map(p => atob(p)).join('');
        }

        window.addEventListener('load', cargarTrabajos);

        function toggleReclamo(elemento) {
            elemento.classList.toggle('expandido');
        }

        function mostrarFormulario(orden) {
            document.getElementById('form-' + orden).classList.add('visible');
        }

        function ocultarFormulario(orden) {
            document.getElementById('form-' + orden).classList.remove('visible');
        }

        async function obtenerTrabajos() {
            try {
                const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${_dt()}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.status === 404) {
                    return { trabajos: {}, sha: null };
                }

                if (response.ok) {
                    const data = await response.json();
                    const contenido = atob(data.content);
                    const trabajos = JSON.parse(contenido);
                    return { trabajos: trabajos, sha: data.sha };
                }

                return { trabajos: {}, sha: null };
            } catch (error) {
                console.error('Error al obtener trabajos:', error);
                return { trabajos: {}, sha: null };
            }
        }

        async function guardarTrabajos(trabajos, sha) {
            try {
                const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;
                const contenidoBase64 = btoa(unescape(encodeURIComponent(JSON.stringify(trabajos, null, 2))));

                const data = {
                    message: 'üîß Actualizaci√≥n de trabajos realizados',
                    content: contenidoBase64
                };

                if (sha) {
                    data.sha = sha;
                }

                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${_dt()}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                return response.ok;
            } catch (error) {
                console.error('Error al guardar trabajos:', error);
                return false;
            }
        }

        async function guardarTrabajo(orden) {
            const tecnico = document.getElementById('tecnico-' + orden).value.trim();
            const descripcion = document.getElementById('descripcion-' + orden).value.trim();
            
            if (!tecnico || !descripcion) {
                alert('Por favor completa tu nombre y la descripci√≥n del trabajo');
                return;
            }

            const botonGuardar = event.target;
            botonGuardar.disabled = true;
            botonGuardar.textContent = 'Guardando...';

            try {
                const { trabajos, sha } = await obtenerTrabajos();

                trabajos[orden] = {
                    tecnico: tecnico,
                    descripcion: descripcion,
                    fecha: new Date().toLocaleString('es-AR')
                };

                const exito = await guardarTrabajos(trabajos, sha);

                if (exito) {
                    mostrarTrabajo(orden, trabajos[orden]);
                    ocultarFormulario(orden);
                    document.getElementById('tecnico-' + orden).value = '';
                    document.getElementById('descripcion-' + orden).value = '';
                    actualizarEstado(orden, true);
                    reorganizarReclamos();
                    alert('‚úÖ Trabajo guardado exitosamente');
                } else {
                    throw new Error('No se pudo guardar');
                }
            } catch (error) {
                console.error('Error al guardar:', error);
                alert('‚ùå Error al guardar el trabajo. Intenta de nuevo.');
            } finally {
                botonGuardar.disabled = false;
                botonGuardar.textContent = 'Guardar';
            }
        }

        function mostrarTrabajo(orden, trabajo) {
            const container = document.querySelector(`[data-orden="${orden}"] .trabajo-container`);
            container.innerHTML = `
                <div class="trabajo-realizado">
                    <strong>‚úÖ Trabajo Realizado</strong><br>
                    <strong>üë§ T√©cnico:</strong> ${trabajo.tecnico}<br>
                    <strong>üìÖ Fecha:</strong> ${trabajo.fecha}<br>
                    <strong>üìù Descripci√≥n:</strong> ${trabajo.descripcion}
                </div>
            `;
        }

        function actualizarEstado(orden, completado) {
            const reclamo = document.querySelector(`[data-orden="${orden}"]`);
            const badge = reclamo.querySelector('.estado-badge');
            const botonContainer = reclamo.querySelector('.botones');
            
            if (completado) {
                reclamo.classList.add('completado');
                badge.textContent = 'Cerrado';
                badge.classList.remove('badge-pendiente');
                badge.classList.add('badge-completado');
                botonContainer.innerHTML = `
                    <button class="btn" style="background:#64748b" onclick="marcarPendiente('${orden}')">‚Ü©Ô∏è Volver a Pendiente</button>
                `;
            } else {
                reclamo.classList.remove('completado');
                badge.textContent = 'Pendiente';
                badge.classList.remove('badge-completado');
                badge.classList.add('badge-pendiente');
                botonContainer.innerHTML = `
                    <button class="btn" onclick="mostrarFormulario('${orden}')">‚úÖ Marcar como Realizado</button>
                `;
            }
            actualizarContador();
        }

        async function marcarPendiente(orden) {
            const confirmar = confirm('¬øSeguro que quieres volver a marcar este reclamo como pendiente?');
            if (!confirmar) return;

            try {
                const { trabajos, sha } = await obtenerTrabajos();
                delete trabajos[orden];

                const exito = await guardarTrabajos(trabajos, sha);
                
                if (exito) {
                    const container = document.querySelector(`[data-orden="${orden}"] .trabajo-container`);
                    container.innerHTML = '';
                    actualizarEstado(orden, false);
                    reorganizarReclamos();
                    alert('‚úÖ Reclamo marcado como pendiente');
                }
            } catch (error) {
                console.error('Error al marcar pendiente:', error);
                alert('‚ùå Error al actualizar. Intenta de nuevo.');
            }
        }

        function reorganizarReclamos() {
            const container = document.querySelector('.container');
            const reclamos = Array.from(document.querySelectorAll('.reclamo'));
            
            reclamos.sort((a, b) => {
                const aCompletado = a.classList.contains('completado');
                const bCompletado = b.classList.contains('completado');
                
                if (aCompletado && !bCompletado) return 1;
                if (!aCompletado && bCompletado) return -1;
                return 0;
            });
            
            const header = document.querySelector('.header');
            reclamos.forEach(reclamo => {
                container.appendChild(reclamo);
            });
            
            container.insertBefore(header, container.firstChild);
        }

        async function cargarTrabajos() {
            const ordenesActuales = Array.from(document.querySelectorAll('[data-orden]'))
                .map(el => el.getAttribute('data-orden'));
            
            console.log('üìã √ìrdenes actuales:', ordenesActuales);

            try {
                const { trabajos, sha } = await obtenerTrabajos();
                console.log('üíæ Trabajos guardados:', trabajos);

                let trabajosActualizados = { ...trabajos };
                let necesitaLimpieza = false;

                for (const orden in trabajos) {
                    if (!ordenesActuales.includes(orden)) {
                        console.log(`üóëÔ∏è Eliminando trabajo de orden antigua: ${orden}`);
                        delete trabajosActualizados[orden];
                        necesitaLimpieza = true;
                    }
                }

                if (necesitaLimpieza) {
                    await guardarTrabajos(trabajosActualizados, sha);
                }

                for (const orden in trabajosActualizados) {
                    if (ordenesActuales.includes(orden)) {
                        mostrarTrabajo(orden, trabajosActualizados[orden]);
                        actualizarEstado(orden, true);
                    }
                }

                reorganizarReclamos();
                actualizarContador();
            } catch (error) {
                console.error('Error al cargar trabajos:', error);
            }
        }

        function actualizarContador() {
            const totalReclamos = document.querySelectorAll('.reclamo').length;
            const completados = document.querySelectorAll('.reclamo.completado').length;
            const pendientes = totalReclamos - completados;
            document.getElementById('totalPendientes').textContent = pendientes;
        }
    </script>
    </div>
</body>
</html>